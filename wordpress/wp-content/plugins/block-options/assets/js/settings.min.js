"use strict";var blockoptsSettingsModule={init:function(){jQuery(".blockopts-module-settings-container").hide(),this.bindEvents()},bindEvents:function(){var e=this,o=jQuery("#wpcontent");o.on("click",".blockopts-toggle-settings, .blockopts-module-settings-cancel",e.openModal),o.on("click",".blockopts-close-modal, .blockopts-modal-background",e.closeModal),o.on("keyup",e.closeModal),o.on("click",".blockopts-toggle-activation",e.moduleToggle),o.on("click",".blockopts-module-settings-save",e.saveSettings),o.on("click",".opts-remove-class-btn",e.removeCustomClass),o.on("click",".blockopts-delete-cache",e.clearWidgetCache),o.on("click",".blockopts-license_deactivate",e.deactivationHandler)},openModal:function(e){e.preventDefault();var o=jQuery(this).parents(".blockopts-module-card").find(".blockopts-module-settings-container");jQuery(".blockopts-modal-background").show(),o.show(),jQuery("body").addClass("blockopts-modal-open")},closeModal:function(e){void 0!==e&&(e.preventDefault(),"keyup"===e.type&&27!==e.which)||(jQuery(".blockopts-modal-background").hide(),jQuery(".blockopts-module-settings-container").hide(),jQuery("body").removeClass("blockopts-modal-open"))},moduleToggle:function(e){e.preventDefault(),e.stopPropagation();var o=jQuery(this),t=o.parents(".blockopts-module-card"),s=t.find(".blockopts-toggle-activation"),a=t.attr("data-module-id");if(s.prop("disabled",!0),o.html()==blockopts.translation.activate)var l="activate";else l="deactivate";blockoptsSettingsModule.ajaxRequest(a,l,{},blockoptsSettingsModule.moduleCallback)},moduleCallback:function(e){var o=e.module,t=e.method,s=jQuery("#blockopts-module-card-"+o),a=s.find(".blockopts-toggle-activation");if(0<e.errors.length)return a.html(blockopts.translations.error).addClass("button-secondary").removeClass("button-primary"),void setTimeout(function(){blockoptsSettingsModule.isModuleActive(o)},1e3);if("activate"===t){a.html(blockopts.translation.deactivate).addClass("button-secondary").removeClass("button-primary").prop("disabled",!1),s.addClass("blockopts-module-type-enabled").removeClass("blockopts-module-type-disabled");var l=blockopts.translation.show_settings}else{a.html(blockopts.translation.activate).addClass("button-primary").removeClass("button-secondary").prop("disabled",!1),s.addClass("blockopts-module-type-disabled").removeClass("blockopts-module-type-enabled");l=blockopts.translation.show_description}s.find(".blockopts-toggle-settings").html(l)},saveSettings:function(e){e.preventDefault();var o=jQuery(this);if(o.hasClass("blockopts-module-settings-save"))var t=o.parents(".blockopts-module-card").attr("data-module-id");else t="";o.prop("disabled",!0);var s={"--blockopts-form-serialized-data":jQuery("#blockopts-module-settings-form").serialize()};blockoptsSettingsModule.ajaxRequest(t,"save",s,blockoptsSettingsModule.savingCallback)},savingCallback:function(e){""===e.module?jQuery("#blockopts-save").prop("disabled",!1):jQuery("#blockopts-module-card-"+e.module+" button.blockopts-module-settings-save").prop("disabled",!1);var o=jQuery(".blockopts-module-cards-container");blockoptsSettingsModule.clearMessages(),0<e.errors.length||!e.closeModal?(blockoptsSettingsModule.showMessages(e.messages,e.module,"open"),o.find(".blockopts-module-settings-content-container:visible").animate({scrollTop:0},"fast")):(blockoptsSettingsModule.showMessages(e.messages,e.module,"closed"),o.find(".blockopts-module-settings-content-container:visible").scrollTop(0),blockoptsSettingsModule.closeModal())},clearMessages:function(){jQuery("#blockopts-settings-messages-container, .blockopts-module-messages-container").empty()},showMessages:function(e,t,s){jQuery.each(e,function(e,o){blockoptsSettingsModule.showMessage(o,t,s)})},showMessage:function(e,o,t){if("closed"!==t&&"open"!==t&&(t="closed"),"string"!=typeof o&&(o=""),"closed"===t||""===o){var s=jQuery("#blockopts-settings-messages-container");setTimeout(function(){s.removeClass("visible"),setTimeout(function(){s.find("div").remove()},500)},4e3)}else s=jQuery("#blockopts-module-card-"+o+" .blockopts-module-messages-container");s.append('<div class="updated fade"><p><strong>'+e+"</strong></p></div>").addClass("visible")},ajaxRequest:function(s,a,l,n){var e={action:blockopts.ajax_action,nonce:blockopts.ajax_nonce,module:s,method:a,data:l};jQuery.post(ajaxurl,e).always(function(e,o,t){blockoptsSettingsModule.processAjaxResponse(e,o,t,s,a,l,n)})},processAjaxResponse:function(e,o,t,s,a,l,n){var c={module:s,method:a,data:l,status:o,license_status:null,jqxhr:null,success:!1,response:null,button:null,errors:[],messages:[],functionCalls:[],redirect:!1,closeModal:!0};"blockOPTS_Response"===(e=jQuery.parseJSON(e)).source&&"undefined"!==e.response&&(c.jqxhr=t,c.success=e.success,c.response=e.response,c.errors=e.errors,c.messages=e.messages,c.functionCalls=e.functionCalls,c.redirect=e.redirect,c.closeModal=e.closeModal,c.button=e.button,void 0!==c.license_status&&(c.license_status=e.license_status)),"function"==typeof n?n(c):"function"==typeof console.log&&console.log("ERROR: Unable to handle settings AJAX request due to an invalid callback:",n,{data:postData,results:c})},removeCustomClass:function(e){jQuery(this).parent("li").fadeOut("fast",function(){jQuery(this).remove()}),e.preventDefault(),e.stopPropagation()},clearWidgetCache:function(e){return jQuery(this).prop("disabled",!0),blockoptsSettingsModule.ajaxRequest("clear_cache","clear_cache","",blockoptsSettingsModule.clearWidgetCacheCallback),!1},clearWidgetCacheCallback:function(e){void 0!==e.response&&(jQuery(".blockopts-delete-cache").after('<span class="dashicons dashicons-yes blockopts-cache-dashicons"></span>'),jQuery(".blockopts-cache-dashicons").delay(2e3).fadeOut(400),jQuery(".blockopts-delete-cache").prop("disabled",!1))},deactivationHandler:function(e){var o;e.preventDefault();var t=jQuery(this);if(t.prop("disabled",!0),""!=(o=jQuery("#"+t.attr("data-target"))).val()){var s={"license-data":o.val(),"license-action":"deactivate",shortname:t.attr("data-shortname"),button:t.attr("id")};blockoptsSettingsModule.ajaxRequest("license_key","deactivate_license",s,blockoptsSettingsModule.licenseDeactivationCallback)}else o.css({border:"1px solid red"}),t.prop("disabled",!1)},licenseDeactivationCallback:function(e){if(void 0!==e.response&&void 0!==e.messages&&void 0!==e.button){var o=jQuery("#"+e.button);jQuery("#"+o.attr("data-target")).before("<span>"+e.messages[0]+"</span>"),"deactivated"==e.success&&(o.parent("td").parent("tr").fadeOut(),jQuery("#"+o.attr("data-target")).val(""))}o.prop("disabled",!1)}};jQuery(document).ready(function(){blockoptsSettingsModule.init()});